<div id="layoutProdutos">produtos</div>
<script type="text/javascript">
//Gera Layout de PDV
/*-----------------------------------------------------------------*/
$( document ).ready(function() {
	$('#layoutProdutos').layout({fit:true,});
	$('#layoutProdutos').layout('add',{//Gera Menu Superior do Modulo
	    region: 'north',
	    border:0,
	    bodyCls:'gradiente1'
	});
	/*-----------------------------------------------------------------*/
	$('#layoutProdutos').layout('add',{//Gera Menu Superior do Modulo
	    region: 'west',
	    width:250,
	    border:0,
	    bodyCls:'blocoDeFiltros',
	    content:`<div class="contentLeft"></div>`
	});

	/*-----------------------------------------------------------------*/
	$('#layoutProdutos').layout('add',{//Gera conteudo Central do Modulo
	    region: 'center',
	    border:0,
	    bodyCls:'sombra_Interna_foot pdg5',
	    content:'<div id="listDeProdutos"></div>'
	});

	/*-----------------------------------------------------------------*/
	$('.contentLeft').layout({fit:true,});
	$('.contentLeft').layout('add',{//Gera Menu Superior do Modulo
	    region: 'north',
	    border: 0,
	    bodyCls:'blocoDeFiltros pdg5',
	    content:`<button id="cadastroRapido">Adicionar</button>
				 <button>Imprimir</button>
	    		`
	});
	$('.contentLeft').layout('add',{//Gera Menu Superior do Modulo
	    region: 'center',
	    border:0,
	    title:'Filtros',
	    bodyCls:'blocoDeFiltros pdg5',
	    content:`<form id="filtro">
				<input type="text" name="cod" placeholder="Código">
				<input type="text" name="produto" placeholder="Produto">
				<input type="text" name="preco" placeholder="Preço">
				</form>
	    		`
	});

	/*-----------------------------------------------------------------*/	
	$('#listDeProdutos').datagrid({
		fit:true,
		pageList:[50,100,200,500],
		pageSize:50,
		fitColumns:true,
		rownumbers:true,
		singleSelect:true,
	    url:'server.php?json=produtos',
	    pagination:true,
	    bodyCls:'inputList',
	    columns:[[
	        {sortable:true,field:'produtos_id',title:'#',width:50,align:'center'},	    
	        {sortable:true,field:'cod',title:'Code',width:100,align:'center',
		    formatter: function(value,row,index){
				return `<input index="1_${index}" class="inputTable" ref="${row.produtos_id}" name="cod" value="${value}">`;
			}},
	        {sortable:true,field:'produto',title:'Produto',width:350,
		    formatter: function(value,row,index){
				return `<input index="2_${index}" class="inputTable" class="money" ref="${row.produtos_id}" name="produto" value="${value}">`;
			}},
	        {sortable:true,field:'preco',title:'Preço',width:80,align:'center',
		    formatter: function(value,row,index){
				return `<input index="3_${index}" class="inputTable money" ref="${row.produtos_id}" name="preco" value="${value}">`;
			}}
	    ]],
	    onLoadSuccess:function(){
	    	$('.money').maskMoney({thousands:'', decimal:'.'});
			$( ".inputTable" ).keyup(function(event) {
				let tecla = event.originalEvent.key;
			  	if(tecla=='Enter'){

			  		var save = {};
			  		save['salvar'] = 'produtos';
			  		save['produtos_id'] = $(this).attr('ref');
			  		save[$(this).attr('name')] = $(this).val();

					$.post( "server.php", save, function( data ) {
						console.log(data)
					});

			  	}
			});	    	
	    },
	    onSelect:function(index){
	    	//$(`[index="1_${index}"]`).focus();
	    }
	});

	//Regras de Friltro
	/*-----------------------------------------------------------------*/
	$( "#filtro" ).keyup(function(event) {
		$this = this;
		$().Deley(function(){
			$('#listDeProdutos').datagrid({
	    		url:'server.php?json=produtos&'+$( $this ).serialize()
	    	});
		})
	});	 

	$('[name="cod"]').select();	


	//Abre Dialod Cadastro Rápido
	/*-----------------------------------------------------------------*/
	$('#cadastroRapido').click(function(){
		dialog({
			href:'modulos/produtos/cadastroRapido.html',
			focus:'[name="cod"]',
			valuesInput:{},
			onOpen:function(id){

			},
			onSave:function(params,id){
				var save = Object.assign({salvar:'produtos'},params);

				if(!params.cod)return false;
				if(!params.produto)return false;
				if(!params.preco)return false;

				$.post( "server.php", save, function( data ) {
					$('#'+id).dialog('close'); 
					$('#listDeProdutos').datagrid('reload');
					console.log(data);
				});
			}
		})
	})



});	
</script>
<style type="text/css">
	.blocoDeFiltros{
		background-color: #eee;
	}
	.blocoDeFiltros input,button{
		margin-bottom: 5px;
		width: 100%;
	}	
	.inputList input{
		width: 100%;
		background-color: #fff;
		box-shadow: none;
		border-width: 0;
	}
</style>