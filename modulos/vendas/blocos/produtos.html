<style type="text/css">
	#codigo{
		background: #77A7FF;
		color: #fff;
		width: 100%;
		text-align: center;
		font-size: 18px;
		font-family: Arial Black;
	}
</style>

<div class="easyui-layout" fit="true">
    <div data-options="region:'north',split:true" style="height:0px;padding: 5px;background-color: #ddd">
    	<input name="codigo" id="codigo" autocomplete="off" placeholder="BURCAR / PREÇO [F2]">
    </div>
    <div data-options="region:'center',title:'PRODUTOS'" >
    	<div id="listaProdutos" ></div>
    </div>
</div>

<!-------------------------------------------------------------------->
<!----------------------------TENPLATES------------------------------->
<!-------------------------------------------------------------------->
<template id="linhas_Produtos">
	<div class='row' style='padding:5px;'>
		<div class='col-2 text-center'>
			<img src='{imgsSelected}' >
		</div>
		<div class='col-10' style="width: 250px">
			<b style='font-size:14px'>{produto}</b><br>
			Preço: <b style='font-size:14px;color:red'>R$ {preco}</b><br>
			Codigo: <b style='font-size:10px;'>{cod}</b><br>
		</div>							
	</div>	
</template>

<script type="text/javascript">


//////Inicia Modulo
/////////////////////////////////////////////////////////////////////////////
$( document ).ready(function() {
	$('#codigo').focus();
});

//////Cria Carrinho
/////////////////////////////////////////////////////////////////////////////
var criaCarrinhoDeCompras = lista({
	onSet:(value)=>{
		//console.log(criaCarrinhoDeCompras);
	}
});

//////Cria Lista
/////////////////////////////////////////////////////////////////////////////
$('#listaProdutos').datalistTemplate({
	//url:"server.php?json=produtos",
	input:"#codigo",
	colMysql:'produto',
	template:'#linhas_Produtos',
	keyup:false
});	

//////Cria Busca
/////////////////////////////////////////////////////////////////////////////
function buscar(value,col){
	$().Deley(function(){
		$('#listaProdutos').datalist({
			url:'server.php?json=produtos&'+col+'='+value
		});				
	})
}

//////Cria Buscador
/////////////////////////////////////////////////////////////////////////////
function addNaLista(value){
	criaCarrinhoDeCompras.add(value);
	var listaCarrinho = [];
	$.each(criaCarrinhoDeCompras.lista, function( index, value ) {
		listaCarrinho.push(value);
	});				
	$('#'+tableSelect).datalistTemplate({
		textField:'produto',
		data: listaCarrinho.reverse(),
		template:'#linhas_Carrinho',
	});	
};

//////Cria Buscador
/////////////////////////////////////////////////////////////////////////////
$('#codigo').buscar({
	onTextDetect:function(value){
		buscar(value.val,'produto');
	},
	onMoneyDetect:function(value){
		buscar(value.val,'preco');
	},
	onCodeDetect:function(value){
		buscar(value.val,'cod');
	},		
	onSend:function(value){

		if(value.type=='money'){
			addNaLista({
				cod:mikrotime(),
				produto:"Produdo Avulso",
				preco:value.val,
				qnt:1,
			});
		}

		if(value.type=='code'){
			$.getJSON('server.php?json=produtos&cod='+value.val, function(resultado){
				addNaLista(resultado.rows[0]);
			});
		}
		
		buscar('***');
	},
	onClean:function(value){
		buscar('***');
	}
});




</script>